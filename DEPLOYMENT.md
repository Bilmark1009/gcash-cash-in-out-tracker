# Deployment & Configuration Guide

## Environment Setup

### Development Environment (.env.example)
```env
APP_NAME=Peraly
APP_ENV=local
APP_DEBUG=true
APP_URL=http://localhost:8000

DB_CONNECTION=sqlite

MAIL_MAILER=log
```

### Configuration

#### 1. Application Settings

Edit `.env`:

```env
# Application
APP_NAME=Peraly
APP_ENV=production
APP_DEBUG=false
APP_URL=https://yourdomain.com

# Timezone
APP_TIMEZONE=Asia/Manila

# Encryption
APP_CIPHER=AES-256-CBC
APP_KEY=base64:xxxxx (auto-generated by php artisan key:generate)
```

#### 2. Database Configuration

##### SQLite (Default, No Setup Needed)
```env
DB_CONNECTION=sqlite
```

##### MySQL
```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=peraly
DB_USERNAME=root
DB_PASSWORD=yourpassword
```

##### PostgreSQL
```env
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=peraly
DB_USERNAME=postgres
DB_PASSWORD=yourpassword
```

#### 3. Session & Cache

```env
SESSION_DRIVER=database
CACHE_DRIVER=file
QUEUE_CONNECTION=sync
```

## Installation Steps

### Step 1: Clone Repository
```bash
git clone <repository-url>
cd gcash-tracker
```

### Step 2: Install Dependencies
```bash
composer install --no-dev
npm install
npm run build
```

### Step 3: Generate Application Key
```bash
php artisan key:generate
```

### Step 4: Configure Database
Edit `.env` with your database credentials

### Step 5: Run Migrations
```bash
php artisan migrate --force
php artisan db:seed
```

### Step 6: Set Permissions (Linux/Mac)
```bash
chmod -R 775 storage bootstrap/cache
chown -R www-data:www-data storage bootstrap/cache
```

### Step 7: Cache Configuration (Production)
```bash
php artisan config:cache
php artisan view:cache
php artisan route:cache
php artisan event:cache
```

## Deployment Platforms

### Shared Hosting (Hostinger, Bluehost)

1. **Upload files** via FTP (except `node_modules/`)
2. **Create database** in cPanel
3. **Email support** to enable `proc_open` if needed
4. Run:
   ```bash
   composer install --no-dev --optimize-autoloader
   php artisan migrate --force
   php artisan db:seed
   ```

### VPS/Cloud (DigitalOcean, Linode, AWS)

1. **Install PHP 8.2+ and MySQL**
   ```bash
   # Ubuntu/Debian
   sudo apt update
   sudo apt install php8.2-fpm php8.2-mysql php8.2-mbstring php8.2-bcmath nginx mysql-server
   ```

2. **Setup Nginx**
   ```nginx
   server {
       listen 80;
       server_name yourdomain.com;
       root /var/www/peraly/public;

       add_header X-Frame-Options "SAMEORIGIN" always;
       add_header X-Content-Type-Options "nosniff" always;
       add_header X-XSS-Protection "1; mode=block" always;

       index index.php;

       location ~ \.php$ {
           fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
           fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
           include fastcgi_params;
       }

       location / {
           try_files $uri $uri/ /index.php?$query_string;
       }
   }
   ```

3. **Deploy & Setup**
   ```bash
   cd /var/www/peraly
   composer install --no-dev --optimize-autoloader
   php artisan migrate --force
   php artisan db:seed
   ```

### Docker

Create `Dockerfile`:
```dockerfile
FROM php:8.2-fpm

# Install dependencies
RUN apt-get update && apt-get install -y \
    curl git zip unzip sqlite3 \
    php8.2-sqlite3 php8.2-mysql php8.2-pgsql

# Install Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

WORKDIR /app

COPY . .

# Install PHP dependencies
RUN composer install --no-dev

# Run migrations
RUN php artisan migrate --force

EXPOSE 8000

CMD ["php", "artisan", "serve", "--host=0.0.0.0"]
```

Run:
```bash
docker build -t peraly .
docker run -p 8000:8000 peraly
```

### Heroku

1. **Login to Heroku**
   ```bash
   heroku login
   heroku create peraly-app
   ```

2. **Create `Procfile`**
   ```
   web: vendor/bin/heroku-php-apache2 public/
   release: php artisan migrate --force
   ```

3. **Deploy**
   ```bash
   git push heroku main
   ```

## Security Configuration

### Environment Variables
```env
APP_DEBUG=false
APP_ENV=production
```

### SSL Certificate (Let's Encrypt)
```bash
# Using Certbot
sudo apt install certbot python3-certbot-nginx
sudo certbot certonly --nginx -d yourdomain.com
```

### Htaccess (Apache)
Create `public/.htaccess`:
```apache
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteRule ^(.*)$ index.php [L]
</IfModule>
```

### Headers Security
Add to `.env`:
```env
SESSION_SECURE_COOKIES=true
SESSION_HTTP_ONLY=true
```

## Database Backup

### Automated Daily Backup (Cron)
```bash
# SQLite
0 2 * * * cp /var/www/peraly/database/database.sqlite /backups/peraly-$(date +\%Y\%m\%d).sqlite

# MySQL
0 2 * * * mysqldump -u username -p password database_name > /backups/peraly-$(date +\%Y\%m\%d).sql
```

### Manual Backup

```bash
# SQLite
cp database/database.sqlite backups/peraly-backup-$(date +%Y%m%d).sqlite

# MySQL
mysqldump -u root -p peraly > backups/peraly-$(date +%Y%m%d).sql

# PostgreSQL
pg_dump peraly > backups/peraly-$(date +%Y%m%d).sql
```

### Restore

```bash
# SQLite
cp backups/peraly-backup.sqlite database/database.sqlite

# MySQL
mysql -u root -p peraly < backups/peraly-backup.sql

# PostgreSQL
psql peraly < backups/peraly-backup.sql
```

## Monitoring & Maintenance

### Enable Logging
In `config/logging.php`:
```php
'channels' => [
    'stack' => [
        'driver' => 'stack',
        'channels' => ['single', 'syslog'],
    ],
    'syslog' => [
        'driver' => 'syslog',
        'level' => 'debug',
    ],
],
```

### Performance Optimization

1. **Enable Caching**
   ```bash
   php artisan config:cache
   php artisan view:cache
   ```

2. **Database Indexing**
   Add to migrations as needed:
   ```php
   $table->index('transaction_date');
   $table->index('category_id');
   $table->fullText(['notes']);
   ```

3. **Query Optimization**
   - Use eager loading: `Transaction::with('category')->get()`
   - Use pagination: `Transaction::paginate(50)`

### Health Check

```bash
# Verify installation
php artisan migrate:status
php artisan about

# Test database
php artisan tinker
DB::connection()->getPdo()
```

## Troubleshooting

### 500 Error
- Check logs: `tail storage/logs/laravel.log`
- Verify permissions: `chmod -R 775 storage bootstrap/cache`
- Verify database: `php artisan migrate:status`

### Database Connection Error
- Verify credentials in `.env`
- Ensure database server is running
- Test connection: `php artisan tinker` then `DB::connection()->getPdo()`

### Cache Issues
- Clear cache: `php artisan cache:clear`
- Clear config: `php artisan config:clear`
- Clear all: `php artisan optimize:clear`

### Permission Denied
```bash
chmod 755 artisan
chmod -R 775 storage bootstrap/cache
(chmod 775 database/database.sqlite if using SQLite)
```

## SSL/HTTPS Setup

### Let's Encrypt with Certbot
```bash
sudo apt install certbot
sudo certbot certonly --standalone -d yourdomain.com
```

### Redirect to HTTPS (Apache)
```apache
<VirtualHost *:80>
    ServerName yourdomain.com
    Redirect permanent / https://yourdomain.com/
</VirtualHost>

<VirtualHost *:443>
    ServerName yourdomain.com
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/yourdomain.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/yourdomain.com/privkey.pem
    DocumentRoot /var/www/peraly/public
</VirtualHost>
```

### Redirect to HTTPS (Nginx)
```nginx
server {
    listen 80;
    server_name yourdomain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;
    
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    
    root /var/www/peraly/public;
    # ... rest of config
}
```

## Scaling Considerations

### Database Optimization
- Archive old transactions (older than 2 years)
- Add proper indexes
- Use read replicas for reports

### Caching Strategy
- Cache category lists
- Cache dashboard stats
- Use Redis for session storage

### Load Balancing
- Deploy multiple application servers
- Use load balancer (Nginx, HAProxy)
- Share database connection

## Regular Maintenance

### Weekly
- Check logs
- Monitor disk space
- Verify backups

### Monthly
- Run optimization: `php artisan optimize`
- Update packages: `composer update`
- Archive old data

### Quarterly
- Security audit
- Performance review
- Database maintenance

---

For more information, see [README.md](README.md) and [QUICKSTART.md](QUICKSTART.md)
